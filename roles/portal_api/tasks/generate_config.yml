---
- name: Check if config template exists
  ansible.builtin.stat:
    path: "{{ prod_dir }}/portal/www/config.json.template"
  register: portal_config_template

- name: Generate portal config.json from template
  ansible.builtin.template:
    src: config.json.j2
    dest: "{{ prod_dir }}/portal/www/config.json"
    owner: root
    group: root
    mode: '0644'
  when: portal_config_template.stat.exists
  register: portal_config_generated
  notify: restart portal-api

- name: Display config generation status
  ansible.builtin.debug:
    msg: "Portal config.json {{ 'generated successfully' if portal_config_generated.changed else 'already up-to-date' }}"
  when: portal_config_template.stat.exists

- name: Warn if config template not found
  ansible.builtin.debug:
    msg: "Warning: portal/www/config.json.template not found, skipping config generation"
  when: not portal_config_template.stat.exists
