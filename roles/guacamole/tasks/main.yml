---
# =============================================================================
# GUACAMOLE ROLE - Main Tasks
# =============================================================================
# Deploys Guacamole bastion with native OIDC authentication

- name: Validate guacamole state variable
  ansible.builtin.assert:
    that:
      - guacamole_state in ['present', 'absent']
    fail_msg: "guacamole_state must be 'present' or 'absent'"

- name: Include prerequisite validation
  ansible.builtin.include_tasks: validate.yml
  when: guacamole_state == 'present'

- name: Include configuration generation
  ansible.builtin.include_tasks: generate_config.yml
  when: guacamole_state == 'present'

- name: Include deployment tasks
  ansible.builtin.include_tasks: deploy.yml
  when: guacamole_state == 'present'

- name: Include removal tasks
  ansible.builtin.include_tasks: remove.yml
  when: guacamole_state == 'absent'
