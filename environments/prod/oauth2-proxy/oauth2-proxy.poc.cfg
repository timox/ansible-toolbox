# oauth2-proxy Configuration POC
# Version simplifiee HTTP pour POC local

## Provider OIDC (Keycloak)
provider = "oidc"
provider_display_name = "Keycloak POC"
oidc_issuer_url = "http://192.168.122.1:8080/realms/poc"
client_id = "oauth2-proxy"
client_secret = "sWzqVbDDTva0dusdrran6OXYCnhWQNBt"
redirect_url = "http://192.168.122.1:4180/oauth2/callback"

## Scopes OIDC
scope = "openid email profile groups"
oidc_groups_claim = "groups"

## Email verification (desactive pour POC)
insecure_oidc_allow_unverified_email = true

## HTTP only (pas de TLS pour POC)
http_address = ":4180"

## Upstreams - nginx backend
upstreams = ["http://nginx-apps:80"]

## Cookies
cookie_name = "_oauth2_proxy"
cookie_secret = "73kAbgS2xiDeXTPdUMfk4YP2zlJDzfFAZcB2X7Ty7Lo="
cookie_domains = ["192.168.122.1"]
cookie_expire = "8h"
cookie_refresh = "1h"
cookie_secure = false
cookie_httponly = true
cookie_samesite = "lax"

## Headers injectes vers upstream
set_xauthrequest = true
pass_access_token = true
pass_authorization_header = false
pass_user_headers = true

## Session storage (cookie-based pour POC simple)
session_store_type = "cookie"

## Metriques Prometheus
metrics_address = ":9090"

## Logging
request_logging = true
auth_logging = true
standard_logging = true

## Email domains (accepter tous)
email_domains = "*"

## Whitelist des domaines
whitelist_domains = ["192.168.122.1", ".192.168.122.1"]

## Reverse Proxy
reverse_proxy = true
real_client_ip_header = "X-Real-IP"

## Health check
ping_path = "/ping"
ready_path = "/ready"

## Skip provider button (aller directement a Keycloak)
skip_provider_button = true
